{% extends "base.html" %}
{% block title %}{{ title }}{% endblock %}

{% block css %}

<style>
body {
  font-family: "Lato", sans-serif;
}

.sidenav {
  width: 180px;
  position: fixed;
  z-index: 1;
  top: 200px;
  left: 50px;
  background: #eee;
  overflow-x: hidden;
  padding: 10px 0;
}

.sidenav a {
  padding: 6px 8px 6px 16px;
  text-decoration: none;
  font-size: 25px;
  color: #2196F3;
  display: block;
}

.sidenav a:hover {
  color: #064579;
}
</style>

{% endblock %}

{% block scripts %}

{{ plots_dict[0] | safe}}

{% endblock %}

{% block content %}

<form style="padding-top:50px" action="{{url_for('test_viewer')}}" method="post" enctype="multipart/form-data">

  {% with messages = get_flashed_messages() %}
  {% if messages %}

  {% for message in messages %}
  <div class="alert alert-success alert-dismissable" role="alert">
    <button type="button" class="close" data-dismiss="alert" aria-label="close">
      <span aria-hidden="true">x</span>
    </button>
    {{message}}
  </div>
  {% endfor %}
  {% endif %}
  {% endwith %}

  <div class="sidenav">

    <div>
      {% if (req.get('VI')) and ((pjs.status == 'open')) %}
      <a href="/current_rooms/{{user}}">
        <button class="btn btn-success btn">My Open rooms</button>
      </a>
      {% else %}
      <a href="/current_rooms/{{user}}">
        <button class="btn btn-success btn" disabled>My Open rooms</button>
      </a>
      {% endif %}
    </div>

    <!--  <form action="{{ url_for('viewer', ProjectName=req.get('project'), RoomName=req.get('room'), user=user, batchID=current_batch) }}" method="post" enctype="multipart/form-data">-->
    {% if (req.get('VI')) and ((pjs.status == 'open')) %}
    &nbsp;
    <button name="next" value="continue" class="btn btn-primary btn">Next empty batch</button>
    {% else %}
    &nbsp;
    <a>
      <button name="next" value="continue" class="btn btn-primary btn" disabled>Next empty batch</button>
    </a>
    {% endif %}
    <!--  </form>-->

    &nbsp;
    &nbsp;

    <div align="center">
      <h5>Targets</h5>
      <div>{{plots_dict[1]['checkbox'] | safe}}</div>
    </div>

    &nbsp;

    <div align="center">
      <h5>Layers</h5>
      <div>{{plots_dict[1]['radio'] | safe}}</div>
    </div>
    &nbsp;
    &nbsp;
    <!--  <form action="{{ url_for('test_viewer') }}">-->
    <div class="form-group" align="center">
      {% if (req.get('VI')) %}
      <a>
        <button name="save" value="continue" class="btn btn-primary btn"><h2>Save</h2></button>
      </a>
      {% else %}
      <a href="#">
        <button name="save" value="continue" class="btn btn-primary btn" disabled><h2>Save</h2></button>
      </a>
      {% endif %}
    </div>
    <!--  </form>-->

  </div>

  <div>
    <div class="container marketing" style="padding-top:50px" method="post">

      <h1>Gallery room <b>{{req.get('room')}}</b></h1>
      <h3>Project <b>{{req.get('project')}}</b></h3>
      <h5>{{req.get('project_description')}}</h5>

      &nbsp;
      <h5>Total cutout images in batch: <b>{{ req.get('%s_%s' %(req.get('room'), current_batch))|length }}</b></h5>
      <h5>Box size (arcsec): <b>{{ req.get('BoxSize') }}</b></h5>

      <div class="form-group row">
        {% for key in plots_dict[1].keys() %}
        <!--        <h4>{{ key }}</h4>-->
        {% if key not in ['checkbox', 'radio'] %}
          <div>{{ plots_dict[1][key] | safe }}</div>

          <div class="cols">
            {% if req.get('VI') %}
            {% for label in req.get('RGlabels') %}
            <div class="form-check">
              {% if label == req.get('vi_query')[key|int] %}
              <input class="form-check-input" type="radio" name={{ "class"+"."+key }} id={{ label }} value={{ label }} checked>
              {% else %}
              <input class="form-check-input" type="radio" name={{ "class" + "." + key }} id={{ label }} value={{ label }}>
              {% endif %}
              <label class="form-check-label" for={{ label }}>
                {{ label }}
              </label>
            </div>
            {% endfor %}
            {% endif %}
          </div>
        {% endif %}

        {% endfor %}
      </div>

      &nbsp;
      &nbsp;

      <nav aria-label="...">
        <ul class="pagination justify-content-center">
          {% if (current_batch + 1) == 1 %}
          <li class="page-item disabled">
            <a class="page-link" href="#">Previous</a>
          </li>
          {% else %}
          <li class="page-item">
            <a class="page-link"
               href="{{ url_for('viewer', ProjectName=req.get('project'), RoomName=req.get('room'), user=user, batchID=current_batch-1) }}">Previous</a>
          </li>
          {% endif %}

          {% for batch in range(req.get('Nbatchs')) %}
          {% if batch == current_batch %}
          <li class="page-item active">
            <a class="page-link"
               href="{{ url_for('viewer', ProjectName=req.get('project'), RoomName=req.get('room'), user=user, batchID=batch) }}">{{
              batch + 1}}<span class="sr-only">(current)</span></a>
          </li>
          {% else %}
          <li class="page-item"><a class="page-link"
                                   href="{{ url_for('viewer', ProjectName=req.get('project'), RoomName=req.get('room'), user=user, batchID=batch) }}">{{
            batch + 1}}</a></li>
          {% endif %}
          {% endfor %}

          {% if (current_batch + 1) == req.get('Nbatchs') %}
          <li class="page-item disabled">
            <a class="page-link" href="#">Next</a>
          </li>
          {% else %}
          <li class="page-item">
            <a class="page-link"
               href="{{ url_for('viewer', ProjectName=req.get('project'), RoomName=req.get('room'), user=user, batchID=current_batch+1) }}">Next</a>
          </li>
          {% endif %}

        </ul>
      </nav>

    </div>
  </div>


</form>


{% endblock %}


